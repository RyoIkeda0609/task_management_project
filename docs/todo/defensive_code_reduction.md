# Defensive Code Reduction Guide

過剰防御コード削減ガイド

目的：
バグ修正フェーズで増えた

- 不要な if
- 不要な null check
- 念のため処理

を安全に取り除き、
コードの読みやすさと責務純度を回復する。

---

# 🎯 大原則

良い設計とは：

「防御が少なくて済む構造」

である。

---

防御が多い =  
どこかの層が責任を果たしていない可能性。

---

---

# 🚨 絶対に理解すること

削除するのは

**安全性**

ではなく

**重複した安全性**。

---

---

# 🧠 判断基準

if / null check を見つけたら  
以下を確認。

---

## Q1.

この状態は  
**正常な経路で到達可能か？**

YES → 残す  
NO → 削除候補

---

---

## Q2.

他の層が保証すべきでは？

YES → 上流へ戻す  
NO → 残す

---

---

## Q3.

テストで守られている？

YES → 削除可能  
NO → 先にテスト追加

---

---

---

# 🔥 削除してよい典型パターン

---

## パターン1

if (entity == null) return;

yaml
コードをコピーする

### しかし

repository.get は  
必ず存在 or throw。

→ 不要。

---

---

## パターン2

if (list.isEmpty) return [];

yaml
コードをコピーする

UseCase 仕様として  
空は合法。

→ 不要。

---

---

## パターン3

if (!mounted) return;

yaml
コードをコピーする

状態管理が正しいなら  
不要な場所がある。

---

---

## パターン4

try {
...
} catch (\_) {
return default;
}

yaml
コードをコピーする

失敗を隠している。

→ 削除 or 明示的例外へ。

---

---

# ❌ 削除してはいけない

---

## ユーザー入力直後

UI保護として意味がある。

---

## 非同期境界

競合が現実的に起こる。

---

## 外部依存

IO / DB / API。

---

---

# ✂ 削除の進め方（安全手順）

---

## Step1

削除候補を列挙。

---

## Step2

その前提を保証する層を確認。

---

## Step3

テストがあるか確認。

なければ先に追加。

---

## Step4

削除。

---

## Step5

全テスト通過。

---

---

# ✨ 理想状態

- if が激減
- 流れが一本道
- 読む速度が上がる
- 責任の所在が明確

---

---

# 🧪 AIへの命令

AIは：

- 念のため
- 安全のため
- 万が一

という理由で  
if を追加してはいけない。

まず

「なぜこの状態が存在するのか」

を考え、
存在自体を消す努力をする。

---

---

# 🏁 完了判定

レビュー時に

「この if 本当に必要？」

と言われなくなる。
