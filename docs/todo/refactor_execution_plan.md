
# refactor_execution_plan.md

本書は `refactor_roadmap.md` をさらに具体化し、

- どの種類の Provider / UseCase から手を付けるか
- どんな順番で触れば安全か
- 未実装機能 / 余計な機能をどう扱うか

を作業レベルまで落とした **実行指示書** である。

---

# 基本原則（絶対）

1. 内側の層を壊さない
2. 一度に広範囲を触らない
3. 変更 → テスト → コミット の小刻み運用

---

# Phase 1：Provider 改善（最優先）

Presentation は最も腐りやすく、
ここを正すだけで寿命が大きく伸びる。

---

## Step 1-1：一覧取得系 Provider

例：

- goal list
- today task list
- milestone list

### やること
- データの並び替え
- フィルタリング
- 進捗計算

が書かれていないか確認。

### あれば
→ UseCase または Domain へ移動。

### 完了判定
Provider には

- 呼び出し
- 状態受け取り

しか残っていない。

---

## Step 1-2：作成・更新系 Provider

例：

- create goal
- add milestone
- add task
- complete task

### やること
成功時の分岐や業務的判断を削除。

### NG例
- 自動で次画面に進める判断
- 成功したから一覧を再構築するロジック

---

## Step 1-3：入力補助系

バリデーションの一部が UI に入っている可能性あり。

### 方針
Domain で拒否できるなら Domain に寄せる。

---

# Phase 2：UseCase の純化

---

## Step 2-1：戻り値の確認

UI 用のデータ構造になっていないか確認。

もしなっていれば：
→ DTO 層へ分離。

---

## Step 2-2：例外処理

try/catch で握りつぶしていないか。

Application は原則：
**投げるだけ**。

---

# Phase 3：Repository の減量

---

## Step 3-1：save/load 時の加工

もし以下があれば削除：

- 自動補完
- 並び替え
- ステータス変更

---

# Phase 4：テスト補強

追加必須テスト：

- 不正な親への追加
- 手動進捗変更の禁止
- 存在しないID

---

# Phase 5：未実装機能の扱い

---

## 代表的な未実装候補

- 通知
- データ同期
- 詳細統計
- テンプレート

### 方針
MVP では触らない。

Issue 管理へ移し、
「思想を壊さない実装方法が定義できたら」再開。

---

# Phase 6：不要機能の検出

以下があれば疑う：

- 便利だが思想に寄与しない
- UI を派手にするだけ
- 思考を代替する自動化

見つけた場合：
削除 or 凍結。

---

# 最終到達点

- Provider が薄い
- UseCase が短い
- Repository が無知
- Domain が全てを守る

ここに達すると、
開発速度はむしろ上がる。
