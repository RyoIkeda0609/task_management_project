# Architecture Recovery After Feature Update

目的：
機能追加により揺れた責務境界を再統一する。

---

# 🎯 状態認識

- バグは少ない
- 構造は概ね健全
- しかし責務の「にじみ」がある

---

今回やることは

削除
移動
統一

のみ。

---

# ====================================

# 1. Domain 層監査

# ====================================

## 問題

一部 ValueObject / Entity に
UI都合の振る舞いが混ざり始めている。

例：

- 表示用整形
- UI向けメソッド名

---

## 修正指示

Domain から

- display
- formatted
- label

という語を含むメソッドを削除。

Domain はビジネスルールのみ。

---

---

# ====================================

# 2. Application 層監査

# ====================================

## 問題

UseCase がわずかに賢くなっている。

- 条件分岐増加
- 複数責務混在

---

## 修正指示

UseCase は orchestration のみ。

判断ロジックは Domain へ。

---

---

# ====================================

# 3. Infrastructure 層監査

# ====================================

## 問題

Repository 実装で

- 例外吸収
- 過剰 null 保護

が増えている。

---

## 修正指示

null は上位で扱わない。

インフラは

正しく失敗する。

---

---

# ====================================

# 4. Presentation 層監査

# ====================================

## 問題

機能追加画面で

- build 構造の揺れ
- header/content/action の不一致

が発生。

---

## 修正指示

最も美しい画面を基準に再統一。

---

---

# ====================================

# 5. ViewModel 監査

# ====================================

## 問題

表示用条件分岐が微増。

---

## 修正指示

state へ移動可能なものは移動。

---

---

# ====================================

# 6. テスト監査

# ====================================

## 問題

新機能の境界テストが薄い。

---

## 修正指示

- 失敗ケース
- 境界値
- 異常系

追加。

---

---

# 完了判定

- 各層に違和感がない
- guard が集中している
- 書き方が対称

🎯 層別スコア詳細
Domain：95

強い。ただし UI臭がわずかに混ざり始めている。

Application：93

少し賢くなりすぎた UseCase がある。

Infrastructure：94

堅いが defensive coding が増えた。

Presentation：95

全体は強いが新画面が完全統一されていない。

テスト：92

正常系は強い。異常系が薄い。
