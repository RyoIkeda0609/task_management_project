# バグ修正依頼書（Presentation修正フェーズ）

このドキュメントは、現在観測されている不具合を
AIが安全に修正するための指示書である。

重要：
今回の修正対象は Presentation 層のみ。
Domain / Application / Infrastructure へ変更を加えてはならない。

---

# 修正完了の定義

以下が全て満たされた場合のみ完了とする。

- 画面遷移が正常に動作する
- 既存テストがすべて成功する
- UseCaseの呼び出し経路に変更がない
- Repositoryの挙動に変更がない

---

# ❗ 禁止事項

AIは以下を行ってはならない。

- Entity修正
- UseCase修正
- Repository修正
- ID仕様変更
- 進捗計算変更
- 状態仕様変更
- 既存テストの期待値変更

問題はUIとナビゲーションの責務で解決すること。

---

---

# 🐞 バグ一覧

---

## 1. オンボーディングの「次へ」ボタンが動かない

### 現象

- 1枚目で「次へ」を押しても2枚目に進まない
- 横スワイプは可能
- ボタン表示は2枚目の状態に変化している

### 推測原因

- PageController の nextPage が呼ばれていない
- または index 更新のみで実ページ移動が無い

### 期待動作

- ボタン押下で PageController.nextPage が呼ばれる
- 確実にページが遷移する

### 完了判定

- ボタン操作のみで最後のページまで到達可能

---

---

## 2. ゴール一覧 → ゴール詳細へ遷移できない

### エラー

Navigator.onGenerateRoute was null, but the route named "/home/goal/{id}" was referenced

### 原因

named route が登録されていない可能性が高い。

### 期待動作

- 指定IDの GoalDetailScreen へ遷移できる

### 必須条件

- ルーティング定義に `/home/goal/:id` が存在する
- もしくは onGenerateRoute が実装されている

### 完了判定

- 任意のゴールタップ → 詳細画面へ100%遷移

---

---

## 3. ビュー切替が機能しない

### 現象

- ピラミッドビュー
- カレンダービュー

に切り替わらない。

### 推測原因

- 状態変更はされているがUIが再構築されていない
- watch / read の使い分けミス

### 期待動作

ボタン押下 → 即座に表示Widgetが切り替わる。

### 完了判定

- 3種類のビューが往復可能

---

---

## 4. タスク編集で日付更新できない

### 現象

- Picker操作後も値が反映されない

### 推測原因

- Controller未更新
- state反映漏れ
- submit時に値が渡っていない

### 期待動作

- 日付変更 → 保存 → 再表示で更新済

### 完了判定

- DB再取得後も変更が維持されている

---

---

## 5. 他エンティティの編集制限確認

### 未確認事項

- Milestone
- Goal

### AIへの指示

Taskと同様に、
編集可能状態では更新できることを確認する。

---

---

# 修正手順（AIの作業順）

1. ルーティング定義確認
2. PageController の挙動確認
3. Provider購読方法確認
4. Form / Controller の submit 経路確認
5. 保存後の再取得確認

---

---

# 修正後に必ず確認すること

- 新規ゴール作成
- 詳細遷移
- ビュー切替
- タスク編集
- 再起動後も維持

---

---

# 失敗とみなすケース

以下が起きたら修正は失敗。

- UseCaseが増える
- Repository変更が入る
- Domainロジックが増える
- テストが壊れる
