# 開発方針書（Development Strategy）

## 1. ドキュメント情報

| 項目           | 内容                                    |
| -------------- | --------------------------------------- |
| ドキュメント名 | 開発方針書                              |
| 版番号         | 1.0                                     |
| 作成日         | 2026年2月1日                            |
| 対象プロダクト | ゴール達成型タスク管理アプリ（Flutter） |
| 目的           | 開発プロセスと進め方の標準化            |

---

## 2. 本ドキュメントの目的

本ドキュメントは、以下を定義する公式文書である：

- **開発プロセス**：どの順序で実装を進めるか
- **品質管理方針**：テスト・レビュー・品質確保の方法
- **コード進捗の可視化**：実装進捗をレビュワーが把握できる構成

---

## 3. 開発の基本方針

### 3.1 コアコンセプト

**「テスト駆動型開発 × ドメイン駆動設計」**

- テスト駆動型開発（TDD）：要件をテストで定義し、実装を進める
- ドメイン駆動設計（DDD）：ビジネスロジック（ドメイン層）に投資を集中する
- **目的**：レビュワーが少ないコード量で品質確保・進捗把握ができる

### 3.2 開発のポイント

| 層                 | 方針                               | テスト範囲     | 優先度 |
| ------------------ | ---------------------------------- | -------------- | ------ |
| Domain（ドメイン） | TDD型で厚く実装、完全な要件の実装  | Unit Test 85%  | 最高   |
| Application        | ユースケース実装、TDD型で実装      | Unit Test 80%  | 高     |
| Infrastructure     | Repository実装、モック化してテスト | モック化で管理 | 中     |
| Presentation       | UI/Widget実装、軽いテスト許容      | 任意           | 低     |

---

## 4. 実装フェーズの進め方

### フェーズ1: ドメイン層の実装（最初の集中投資期）

**目的**：ビジネスロジックをテストで定義し、完全な実装を完成させる

**進め方**：

1. **テスト要件の整理（Red Phase）**
   - 要件定義書（2_requirements.md）からドメイン層の振る舞いを読み取る
   - 必要に応じてレビュワー（ユーザー）にヒアリングして要件を明確化
   - テストコード（Unit Test）を作成する

2. **実装（Green Phase）**
   - ドメイン層のコード（Entity / ValueObject）を実装
   - すべてのテストをパスさせる

3. **リファクタリング（Refactor Phase）**
   - 実装をきれいに整理
   - 不必要な複雑性を削除

**成果物**：

- `lib/domain/entities/` - Goal / Milestone / Task
- `lib/domain/value_objects/` - TaskStatus など
- `test/domain/` - 85%のテストカバレッジ

**期間の目安**：1～2週間（進捗計算ロジックが複雑なため）

---

### フェーズ2: ユースケース（Application）層の実装

**目的**：UI のロジックをテストで定義し、ドメインを組み合わせた処理を実装

**進め方**：

1. 基本設計書（3_design.md）から必要なユースケースを抽出
2. テストコードを作成（Red Phase）
3. ユースケースを実装（Green Phase）
4. リファクタリング（Refactor Phase）

**成果物**：

- `lib/application/usecases/` - GoalCreateUseCase など
- `test/application/` - 80%のテストカバレッジ

**期間の目安**：1～2週間

---

### フェーズ3: インフラ層（Infrastructure）の実装

**目的**：ドメイン層とのやり取りをするリポジトリを実装

**進め方**：

1. Repository インターフェース（抽象層）を定義
2. テストはモック化した状態でテスト（実ファイルアクセスはしない）
3. Hive との連携実装
4. スキーマ定義（MVP ではスキーマ変更なしで固定）

**成果物**：

- `lib/infrastructure/repositories/` - GoalRepository 実装
- `lib/infrastructure/datasources/` - Hive アダプター
- `test/infrastructure/` - モック化されたテスト

**期間の目安**：1週間

---

### フェーズ4: UI/Presentation 層の実装

**目的**：設計書に基づき、画面 UI を実装

**進め方**：

1. 基本設計書（3_design.md）の画面設計に基づき実装
2. Riverpod Provider で状態管理
3. テストは軽く：Widget Test のみ（Unit Test は省略許可）
4. レビュワーが画面を確認できるまで実装

**成果物**：

- `lib/presentation/screens/` - 各画面の実装
- `lib/presentation/widgets/` - 再利用可能なウィジェット
- `test/presentation/` - 重要なWidget Test のみ

**期間の目安**：2～3週間

---

## 5. レビュープロセス

### 5.1 レビュースケジュール

| フェーズ     | レビュー対象            | レビュー頻度    | 期待事項                   |
| ------------ | ----------------------- | --------------- | -------------------------- |
| Domain       | テストコード + 実装     | 毎日 or 終了後  | 要件理解、テスト設計確認   |
| Application  | テストコード + 実装     | 毎日 or 終了後  | ユースケース正当性確認     |
| Infra        | Repository + モック実装 | フェーズ終了時  | 設計・インターフェース確認 |
| Presentation | 画面スクリーンショット  | 画面毎 or 週1回 | UI/UX の要件合致確認       |

### 5.2 レビュー時に確認すること

**Domain / Application フェーズ**

- テストコードが要件をカバーしているか
- 要件の取り違えがないか
- テストがパスするコードが書かれているか

**Infrastructure フェーズ**

- Repository インターフェースが抽象的であるか
- テストがモック化されているか

**Presentation フェーズ**

- 基本設計書（3_design.md）の画面仕様を満たしているか
- ユーザーフローが正しいか

---

## 6. ドキュメント参照ルール

| 実装対象       | 参照ドキュメント     | 確認項目                                    |
| -------------- | -------------------- | ------------------------------------------- |
| Domain         | 2_requirements.md    | 機能要件、CRUD 仕様、進捗計算ロジック       |
| Application    | 2_requirements.md    | ユースケース、制約、検証ルール              |
| Infrastructure | 4_architecture.md    | Repository インターフェース、Hive スキーマ  |
| Presentation   | 3_design.md          | 画面レイアウト、ナビゲーション、UX ポリシー |
| 全体           | 1_product_concept.md | 思想、ガードレール、制約                    |

---

## 7. 品質基準

### 7.1 テストカバレッジ目標

| 層             | 目標     | 実装の難易度 | 優先度 |
| -------------- | -------- | ------------ | ------ |
| Domain         | 85% 以上 | 中～高       | 必須   |
| Application    | 80% 以上 | 中           | 必須   |
| Infrastructure | モック化 | 低～中       | 必須   |
| Presentation   | 任意     | 低           | 許容   |

### 7.2 コード品質基準

- **可読性**：意図が明確なコード
- **保守性**：テストが書きやすい設計
- **拡張性**：Phase2 に向けた拡張性を考慮（Repository インターフェースなど）

---

## 8. 開発環境・ツール

| 項目                 | 選択         | 理由                               |
| -------------------- | ------------ | ---------------------------------- |
| 言語                 | Dart 2.19+   | Flutter 公式言語                   |
| フレームワーク       | Flutter 3.0+ | クロスプラットフォーム対応         |
| 状態管理             | Riverpod     | 型安全、テスト可能                 |
| ローカルDB           | Hive         | シンプル、MVP に十分な機能         |
| アーキテクチャ       | Clean Arch   | レイヤー分離、テスト容易           |
| テストフレームワーク | test         | Dart 標準                          |
| DDD 適用範囲         | Entity/VO    | MVP では最小限（Aggregate は不要） |

---

## 9. 懸念点・検討項目

### 9.1 ドメイン層で不明な点

現在の要件定義書からは以下の点が完全には明確ではないため、**フェーズ1 開始前** にレビュワーとの確認が必要：

1. **進捗計算のバリデーション**
   - タスクが 0 個の場合、マイルストーン進捗は 0% ？ それとも未定義状態？
   - 参考：[2_requirements.md#4.4](2_requirements.md) の進捗計算仕様

2. **期限バリデーション**
   - タスク期限 ≤ マイルストーン期限 ≤ ゴール期限 の強制？
   - それとも単なる警告？

3. **ゴール達成時の自動完了**
   - ゴール配下のマイルストーン / タスクが全て完了したら、ゴールは自動完了？
   - それとも手動での完了操作が必要？

### 9.2 テスト設計の検討

- **進捗計算ロジックのテスト複雑度**：タスク数が多い場合、パフォーマンステストが必要か
- **状態遷移のテスト**：Todo → Doing → Done のみか。バリデーションルールは？

---

## 10. スケジュール目安

| フェーズ       | 予定期間      | 主な成果物             |
| -------------- | ------------- | ---------------------- |
| Domain         | 1～2 週間     | Entity / VO / UT 85%   |
| Application    | 1～2 週間     | UseCase / UT 80%       |
| Infrastructure | 1 週間        | Repository / モック UT |
| Presentation   | 2～3 週間     | UI / 画面実装完成      |
| **合計**       | **5～8 週間** | **MVP 完成予定**       |

**目標リリース日（6月末）に向けて、3月初旬から開始予定**

---

## 11. 進捗報告ルール

### 11.1 毎日の報告

- その日に完成した機能 / テスト
- 明日の予定
- ブロッカー（困っていること）

### 11.2 フェーズ終了時の報告

- テストカバレッジの数字
- 実装したコード行数
- 設計変更の有無
- Phase 2 への引き継ぎ事項

---

## 12. 補足：DDD 適用範囲の確認

**MVP では適用しない（Phase 2+ で検討）**

- Aggregate / Repository Pattern（Aggregate の概念）
- Domain Service（複数 Entity にまたがるロジック）
- Factory Pattern（複雑なオブジェクト生成）

**MVP で適用する（コア概念のみ）**

- **Entity**：Goal / Milestone / Task（ID を持つオブジェクト）
- **ValueObject**：TaskStatus（不変値オブジェクト）
- **Bounded Context**：目標達成というドメインに集中（他ドメインは切り出さない）

---

## 13. このドキュメントの使用方法

1. **開発者向け**：毎日の開発時に、現在のフェーズに応じて参照
2. **レビュワー向け**：何をレビューするべきかを把握するために参照
3. **プロジェクト管理**：進捗状況と品質基準を確認するために参照

---

**作成者**：GitHub Copilot  
**確認者**：プロダクトオーナー  
**最終確認日**：2026年2月1日
