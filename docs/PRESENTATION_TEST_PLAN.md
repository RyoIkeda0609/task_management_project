# Presentation層 テスト計画

**対象**: ゴール達成型タスク管理アプリ  
**作成日**: 2026年2月5日  
**目的**: Presentation層の品質保証とリグレッション防止

---

## 1. テスト戦略

### 1.1 テスト階層

```
┌─────────────────────────────────┐
│  E2E Tests (Integration)        │  ← 画面遷移、ユーザーフロー
└─────────────────────────────────┘
             ↓
┌─────────────────────────────────┐
│  Widget Tests                   │  ← 画面の表示・インタラクション
│  - UI動作確認                   │
│  - 入力フォーム検証             │
│  - ダイアログ表示               │
└─────────────────────────────────┘
             ↓
┌─────────────────────────────────┐
│  Unit Tests                     │  ← ビルダーメソッド、ロジック
│  - 共通Widget                   │
│  - ヘルパー関数                 │
└─────────────────────────────────┘
```

### 1.2 対象範囲

✅ **テスト対象:**
- 全スクリーン（11画面）
- 共通Widget（7つ）
- Navigation（ルーティング）
- フォーム検証
- ダイアログ表示

❌ **テスト対象外:**
- 外部API呼び出し（Riverpod providerは mock）
- デバイス固有機能（カメラ等）

---

## 2. テストケース一覧

### 2.1 共通Widget テスト

#### CustomAppBar
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T001 | タイトルが正しく表示される | テキスト表示確認 | 高 |
| T002 | 戻るボタンが表示される | hasLeading=true時に表示 | 高 |
| T003 | 戻るボタンが機能する | タップで Navigator.pop() | 高 |
| T004 | アクションボタンが表示される | actions パラメータ | 中 |

#### CustomButton
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T005 | Primary ボタンが表示される | 背景色が primary | 高 |
| T006 | Secondary ボタンが表示される | 背景色が secondary | 高 |
| T007 | Danger ボタンが表示される | 背景色が error | 高 |
| T008 | ボタンタップが機能する | onPressed コールバック実行 | 高 |
| T009 | ボタン無効状態が反映される | disabled時にタップ無効 | 中 |

#### CustomTextField
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T010 | ラベルが表示される | label パラメータ | 高 |
| T011 | テキスト入力が可能 | onChanged コールバック | 高 |
| T012 | 初期値が反映される | initialValue パラメータ | 高 |
| T013 | バリデーションが機能する | validator コールバック | 中 |
| T014 | パスワードモードが機能する | obscureText フラグ | 中 |

#### StatusBadge
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T015 | Todo ステータスが表示される | 正しいアイコン・色 | 高 |
| T016 | Doing ステータスが表示される | 正しいアイコン・色 | 高 |
| T017 | Done ステータスが表示される | 正しいアイコン・色 | 高 |
| T018 | サイズが正しく適用される | small/medium/large | 中 |

#### EmptyState
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T019 | アイコンが表示される | icon パラメータ | 高 |
| T020 | タイトルが表示される | title テキスト | 高 |
| T021 | メッセージが表示される | message テキスト | 高 |
| T022 | アクションボタンが表示される | actionText + onActionPressed | 中 |

#### DialogHelper
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T023 | 確認ダイアログが表示される | showConfirmDialog | 高 |
| T024 | エラーダイアログが表示される | showErrorDialog | 高 |
| T025 | 成功ダイアログが表示される | showSuccessDialog | 高 |
| T026 | ボタンが機能する | OK/キャンセル処理 | 高 |

### 2.2 画面テスト

#### HomeScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T100 | ゴール一覧が表示される | ListView 表示 | 高 |
| T101 | 空状態が表示される | EmptyState 表示（ゴールなし） | 高 |
| T102 | FAB が表示される | FloatingActionButton | 高 |
| T103 | ゴールタップで詳細画面に遷移 | pushNamed(goalDetail) | 高 |
| T104 | FAB タップでゴール作成画面に遷移 | pushNamed(goalCreate) | 高 |

#### GoalCreateScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T105 | ゴール名フィールドが表示される | CustomTextField | 高 |
| T106 | 説明フィールドが表示される | CustomTextField multiline | 高 |
| T107 | カテゴリードロップダウンが表示される | 5つのカテゴリー | 高 |
| T108 | 期限選択が機能する | showDatePicker | 高 |
| T109 | バリデーション：ゴール名が空 | エラー表示 | 高 |
| T110 | バリデーション：期限が未選択 | エラー表示 | 高 |
| T111 | 作成成功でダイアログ表示 | showSuccessDialog | 高 |
| T112 | ダイアログ確認後に前画面に戻る | pop() 2回 | 高 |

#### GoalDetailScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T113 | ゴール情報が表示される | タイトル・説明・期限 | 高 |
| T114 | マイルストーン一覧が表示される | ListView | 高 |
| T115 | マイルストーンタップで詳細画面に遷移 | pushNamed(milestoneDetail) | 高 |
| T116 | FAB でマイルストーン作成画面に遷移 | pushNamed(milestoneCreate) | 高 |

#### GoalEditScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T117 | ゴール情報が読み込まれる | 既存データ表示 | 高 |
| T118 | フィールドが編集可能 | initialValue 反映 | 高 |
| T119 | 更新成功でダイアログ表示 | showSuccessDialog | 高 |

#### MilestoneCreateScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T120 | マイルストーン名フィールドが表示 | CustomTextField | 高 |
| T121 | 目標日時選択が機能 | showDatePicker | 高 |
| T122 | ゴール ID が表示 | 紐付け確認 | 高 |
| T123 | バリデーション：名前が空 | エラー表示 | 高 |
| T124 | バリデーション：日時が未選択 | エラー表示 | 高 |

#### MilestoneDetailScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T125 | マイルストーン情報が表示 | タイトル・期限 | 高 |
| T126 | タスク一覧が表示 | ListView | 高 |
| T127 | 空状態でメッセージ表示 | EmptyState | 高 |
| T128 | FAB でタスク作成画面に遷移 | pushNamed(taskCreate) | 高 |

#### TaskCreateScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T129 | タスク名フィールドが表示 | CustomTextField | 高 |
| T130 | 説明フィールドが表示 | CustomTextField multiline | 高 |
| T131 | 期限選択が機能 | showDatePicker | 高 |
| T132 | マイルストーン情報が表示 | 紐付け確認 | 高 |
| T133 | バリデーション：名前が空 | エラー表示 | 高 |

#### TaskDetailScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T134 | タスク情報が表示 | タイトル・説明・期限 | 高 |
| T135 | ステータスが表示 | 正しいアイコン・テキスト | 高 |
| T136 | ステータス変更ボタンが表示 | 3つのボタン | 高 |
| T137 | ステータス変更でスナックバー表示 | 変更確認メッセージ | 高 |

#### TodayTasksScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T138 | 本日のタスク一覧が表示 | ListView | 高 |
| T139 | 空状態でメッセージ表示 | EmptyState | 高 |
| T140 | ステータス別グループ化 | 未完了/進行中/完了 | 高 |
| T141 | 進捗サマリーが表示 | 達成率表示 | 中 |

#### SettingsScreen
| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T142 | ユーザー情報が表示 | アイコン・ユーザー名 | 中 |
| T143 | 通知設定切り替え | Switch 動作 | 中 |
| T144 | ダークモード設定切り替え | Switch 動作 | 中 |
| T145 | ヘルプリンク機能 | ダイアログ表示 | 低 |
| T146 | ログアウト確認ダイアログ | 確認ダイアログ表示 | 中 |

### 2.3 Navigation テスト

| テストID | テスト項目 | 期待値 | 優先度 |
|---------|---------|-------|------|
| T200 | Splash → Home 遷移 | onboarding_complete=true | 高 |
| T201 | Splash → Onboarding 遷移 | onboarding_complete=false | 高 |
| T202 | Onboarding → Home 遷移 | 完了ボタン押下 | 高 |
| T203 | Home → GoalDetail 遷移 | ゴールタップ | 高 |
| T204 | Home → GoalCreate 遷移 | FAB タップ | 高 |
| T205 | すべてのルート定義が存在 | 12+ routes | 高 |

---

## 3. テスト実装優先度

### フェーズ1（重要度 高）
1. 共通Widget テスト（T001-T026）
2. Navigation テスト（T200-T205）
3. 主要画面テスト：HomeScreen, GoalCreateScreen, GoalDetailScreen

### フェーズ2（重要度 中）
4. 詳細画面テスト：MilestoneCreateScreen, TaskCreateScreen, TaskDetailScreen
5. TodayTasksScreen テスト
6. SettingsScreen テスト（low priority）

### フェーズ3（品質向上）
7. エラーハンドリングテスト
8. 状態管理テスト（Riverpod）
9. アニメーションテスト

---

## 4. テストカバレッジ目標

- 共通Widget: 100% カバレッジ
- 主要画面: 80%+ カバレッジ
- Navigation: 100% ルートテスト
- 全体: 75%+ カバレッジ目標

---

## 5. テスト環境

- **フレームワーク**: flutter_test + Mockito
- **ドライバー**: Integration Test（オプション）
- **CI/CD**: flutter test で自動実行

---

## 6. 実装スケジュール

```
Week 1:
- 共通Widget テスト実装（3画面分）
- Navigation テスト実装

Week 2:
- 主要画面テスト実装（3画面）
- バグ修正・改善

Week 3:
- 詳細画面テスト実装（5画面）
- カバレッジ分析・改善

Week 4:
- E2E テスト・統合テスト
- リグレッション確認
- 本番デプロイ準備
```

---

## 7. 品質メトリクス

- コード総行数: ~3000 行
- テスト総行数: ~2000 行（目標）
- カバレッジ: 75%+ 目標
- バグ検出率: 90%+ 目標

---

**次ステップ**: フェーズ1のテスト実装開始
