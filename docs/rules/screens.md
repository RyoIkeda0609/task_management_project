# 画面一覧・画面遷移図

## 1. ドキュメント情報

| 項目           | 内容                           |
| -------------- | ------------------------------ |
| ドキュメント名 | 画面一覧・画面遷移図           |
| 最終更新日     | 2026年2月22日                  |
| 対象プロダクト | ゴール達成型タスク管理アプリ   |
| 位置づけ       | 画面構成とナビゲーションの定義 |

---

## 2. ナビゲーション構成

### 2.1 ボトムナビゲーション（3タブ）

アプリのメインナビゲーションは `StatefulShellRoute.indexedStack` による3タブ構成です。

| タブNo | タブ名       | ルートパス     | 画面             |
| ------ | ------------ | -------------- | ---------------- |
| 1      | ホーム       | `/home`        | ゴール一覧       |
| 2      | 今日のタスク | `/today_tasks` | 今日のタスク一覧 |
| 3      | 設定         | `/settings`    | 設定画面         |

### 2.2 タブ外画面

| 画面             | ルートパス     | 備考                     |
| ---------------- | -------------- | ------------------------ |
| スプラッシュ     | `/`            | 起動時に表示             |
| オンボーディング | `/onboarding`  | 初回起動時のみ表示       |
| ゴール作成       | `/goal_create` | タブ外のトップレベル画面 |

---

## 3. 画面一覧

### 3.1 全画面一覧

| No  | 画面名               | ルートパス                                       | 役割                       | 構成ファイル                                                     |
| --- | -------------------- | ------------------------------------------------ | -------------------------- | ---------------------------------------------------------------- |
| 1   | スプラッシュ画面     | `/`                                              | 起動演出                   | `splash/` (page, state, view_model, widgets)                     |
| 2   | オンボーディング画面 | `/onboarding`                                    | 思想理解・初回導線         | `onboarding/` (page, state, view_model, widgets)                 |
| 3   | ゴール作成画面       | `/goal_create`                                   | ゴール新規作成             | `goal/goal_create/` (page, state, view_model, widgets)           |
| 4   | ゴール一覧（ホーム） | `/home`                                          | ゴール全体像把握           | `home/` (page, state, view_model, widgets)                       |
| 5   | ゴール詳細画面       | `/home/goal/:goalId`                             | 計画と行動の中心           | `goal/goal_detail/` (page, state, view_model, widgets)           |
| 6   | ゴール編集画面       | `/home/goal/:goalId/edit`                        | ゴール情報編集             | `goal/goal_edit/` (page, state, view_model, widgets)             |
| 7   | MS作成画面           | `/home/goal/:goalId/milestone_create`            | MS新規作成                 | `milestone/milestone_create/` (page, state, view_model, widgets) |
| 8   | MS詳細画面           | `/home/goal/:goalId/milestone/:milestoneId`      | MS詳細確認                 | `milestone/milestone_detail/` (page, state, view_model, widgets) |
| 9   | MS編集画面           | `/home/goal/:goalId/milestone/:milestoneId/edit` | MS情報編集                 | `milestone/milestone_edit/` (page, state, view_model, widgets)   |
| 10  | タスク作成画面       | `.../milestone/:milestoneId/task_create`         | タスク新規作成             | `task/task_create/` (page, state, view_model, widgets)           |
| 11  | タスク詳細画面       | `.../milestone/:milestoneId/task/:taskId`        | タスク詳細・状態変更       | `task/task_detail/` (page, state, view_model, widgets)           |
| 12  | タスク編集画面       | `.../milestone/:milestoneId/task/:taskId/edit`   | タスク情報編集             | `task/task_edit/` (page, state, view_model, widgets)             |
| 13  | 今日のタスク画面     | `/today_tasks`                                   | 横断タスク表示             | `today_tasks/` (page, state, view_model, widgets)                |
| 14  | 今日のタスク詳細     | `/today_tasks/task/:taskId`                      | タスク詳細（今日タブ経由） | `task/task_detail/` を再利用                                     |
| 15  | 今日のタスク編集     | `/today_tasks/task/:taskId/edit`                 | タスク編集（今日タブ経由） | `task/task_edit/` を再利用                                       |
| 16  | 設定画面             | `/settings`                                      | 補助的設定                 | `settings/settings_page/` (page, state, view_model, widgets)     |

### 3.2 画面構成パターン

すべての画面は以下の **4ファイル構成** で統一されています。

| ファイル              | 役割                                                              |
| --------------------- | ----------------------------------------------------------------- |
| `xxx_page.dart`       | `ConsumerWidget`。Scaffold + Provider接続 + ナビゲーション        |
| `xxx_state.dart`      | 画面専用のUIモデル。`viewState` enum + ファクトリ                 |
| `xxx_view_model.dart` | `StateNotifier<XxxPageState>`。フォーム管理 + UseCase呼び出し     |
| `xxx_widgets.dart`    | 画面固有のUIパーツ。`_Body` → `switch (state.viewState)` パターン |

---

## 4. 画面遷移図

### 4.1 初回起動フロー

```
アプリ起動
  │
  ▼
スプラッシュ画面 (/)
  │
  ├─ [オンボーディング未完了]
  │      │
  │      ▼
  │   オンボーディング画面 (/onboarding)
  │      │  ※スキップ不可
  │      ▼
  │   ゴール一覧・ホーム (/home)
  │
  └─ [オンボーディング完了済み]
         │
         ▼
      ゴール一覧・ホーム (/home)
```

### 4.2 通常起動フロー

```
アプリ起動
  │
  ▼
スプラッシュ画面 (/)
  │
  ▼
ゴール一覧・ホーム (/home)
```

### 4.3 メイン画面遷移図

```
┌─────────────────────────────────────────────────────────────────────┐
│  ボトムナビゲーション                                                │
│                                                                     │
│  [ホーム]              [今日のタスク]            [設定]              │
│  /home                 /today_tasks              /settings           │
└─────┬─────────────────────┬─────────────────────────┘
      │                     │
      │                     │
      ▼                     ▼
┌─────────────┐      ┌──────────────┐
│ゴール一覧    │      │今日のタスク   │
│(ホーム)      │      │一覧           │
│              │      │              │
│ ゴールカード │      │ タスクカード  │
│  をタップ    │      │  をタップ     │
└──────┬──────┘      └──────┬───────┘
       │                     │
       ▼                     ▼
┌──────────────┐      ┌──────────────┐
│ゴール詳細     │      │タスク詳細     │
│              │      │(今日タブ経由) │
│ ・ゴール情報 │      │              │
│ ・MS一覧     │      │  編集ボタン  │
│ ・ビュー切替 │      └──────┬───────┘
│  (リスト/     │              │
│   ピラミッド/ │              ▼
│   カレンダー) │      ┌──────────────┐
│              │      │タスク編集     │
│ 編集ボタン   │      │(今日タブ経由) │
│ 削除ボタン   │      └──────────────┘
│ MS作成ボタン │
└──┬───┬───┬──┘
   │   │   │
   │   │   └─────────────────────────┐
   │   │                             │
   │   ▼                             ▼
   │  ┌──────────────┐      ┌──────────────┐
   │  │ゴール編集     │      │MS作成        │
   │  └──────────────┘      └──────────────┘
   │
   ▼
┌──────────────┐
│MS詳細        │
│              │
│ ・MS情報     │
│ ・タスク一覧 │
│              │
│ 編集ボタン   │
│ 削除ボタン   │
│ タスク作成   │
└──┬───┬───┬──┘
   │   │   │
   │   │   └─────────────────────────┐
   │   │                             │
   │   ▼                             ▼
   │  ┌──────────────┐      ┌──────────────┐
   │  │MS編集        │      │タスク作成     │
   │  └──────────────┘      └──────────────┘
   │
   ▼
┌──────────────┐
│タスク詳細    │
│              │
│ ・タスク情報 │
│ ・状態変更   │
│  (Todo/Doing │
│   /Done循環) │
│              │
│ 編集ボタン   │
│ 削除ボタン   │
└──────┬───────┘
       │
       ▼
┌──────────────┐
│タスク編集    │
└──────────────┘
```

### 4.4 ゴール作成への導線

```
ゴール一覧（ホーム）
  │
  ├─ [ + FABボタン ]
  │      │
  │      ▼
  │   ゴール作成画面 (/goal_create)
  │      │
  │      ▼
  │   ゴール一覧（ホーム）に戻る
  │
  └─ [ゴールが0件の場合]
         │
         ▼
      空状態（EmptyState）表示
         │
         ▼
      ゴール作成ボタンから作成画面へ
```

---

## 5. 画面詳細設計

### 5.1 スプラッシュ画面

| 項目     | 内容                                                          |
| -------- | ------------------------------------------------------------- |
| 目的     | 起動演出 + 初期化                                             |
| 表示時間 | 短時間（初期化完了後に自動遷移）                              |
| 遷移先   | オンボーディング未完了 → オンボーディング / 完了済み → ホーム |

### 5.2 オンボーディング画面

| 項目     | 内容                               |
| -------- | ---------------------------------- |
| 目的     | 思想理解・ゴール作成への心理的準備 |
| 構成     | 1〜2画面。短文のみで説明           |
| スキップ | **不可**                           |
| 完了後   | ゴール一覧（ホーム）へ遷移         |
| 再表示   | なし（完了フラグをHiveに保存）     |

### 5.3 ゴール一覧（ホーム）

| 項目       | 内容                             |
| ---------- | -------------------------------- |
| 目的       | 現在のゴール全体像の把握         |
| 表示項目   | ゴール名 / 期限 / 進捗率         |
| ソート     | 期限昇順（固定）                 |
| フィルター | 活動中 / 完了済み                |
| 操作       | ゴールタップ → 詳細 / FAB → 作成 |
| 空状態     | EmptyStateウィジェット表示       |

### 5.4 ゴール詳細画面（中核）

| 項目   | 内容                                    |
| ------ | --------------------------------------- |
| 目的   | 計画と行動をつなぐ中心画面              |
| 表示   | ゴール情報 + MS一覧 + タスク一覧        |
| ビュー | リスト / ピラミッド / カレンダー の切替 |
| 操作   | 編集 / 削除 / MS作成 / MS詳細遷移       |

### 5.5 ゴール編集画面

| 項目 | 内容                                 |
| ---- | ------------------------------------ |
| 目的 | ゴール情報の変更                     |
| 制約 | 完了済みゴールは遷移不可（閲覧のみ） |
| 入力 | ゴール名 / 期限 / カテゴリ / 理由    |

### 5.6 マイルストーン作成画面

| 項目 | 内容                         |
| ---- | ---------------------------- |
| 目的 | MS新規追加                   |
| 制約 | 常にゴール配下でのみ作成可能 |
| 入力 | MS名 / 期限                  |

### 5.7 マイルストーン詳細画面

| 項目 | 内容                                      |
| ---- | ----------------------------------------- |
| 目的 | MS配下のタスク管理                        |
| 表示 | MS情報 + 配下タスク一覧                   |
| 操作 | 編集 / 削除 / タスク作成 / タスク詳細遷移 |

### 5.8 マイルストーン編集画面

| 項目 | 内容                             |
| ---- | -------------------------------- |
| 目的 | MS情報の変更                     |
| 制約 | 完了済みMSは遷移不可（閲覧のみ） |
| 入力 | MS名 / 期限                      |

### 5.9 タスク作成画面

| 項目 | 内容                     |
| ---- | ------------------------ |
| 目的 | タスク新規追加           |
| 制約 | 常にMS配下でのみ作成可能 |
| 入力 | タスク名 / 期限 / 説明   |

### 5.10 タスク詳細画面

| 項目     | 内容                                             |
| -------- | ------------------------------------------------ |
| 目的     | タスク詳細確認・ステータス変更                   |
| 表示     | タスク名 / 期限 / 説明 / ステータス              |
| 状態変更 | ボタンタップで循環（Todo → Doing → Done → Todo） |
| 操作     | 編集 / 削除                                      |
| 制約     | Done状態のタスクは編集ボタン無効                 |

### 5.11 タスク編集画面

| 項目 | 内容                           |
| ---- | ------------------------------ |
| 目的 | タスク情報の変更               |
| 制約 | Done状態は遷移不可（閲覧のみ） |
| 入力 | タスク名 / 期限 / 説明         |

### 5.12 今日のタスク画面

| 項目     | 内容                                     |
| -------- | ---------------------------------------- |
| 目的     | 行動に集中させる                         |
| 表示対象 | 全ゴール横断で本日以前が期限のタスク     |
| 過期限   | 昨日以前のタスクも表示（忘れ防止）       |
| 空状態   | 「本日やるタスクはありません」と表示     |
| 表示項目 | ゴール名 / MS名 / タスク名 / 期限 / 状態 |
| 操作     | タスクタップ → タスク詳細                |

### 5.13 設定画面

| 項目     | 内容                                             |
| -------- | ------------------------------------------------ |
| 目的     | 最小限の設定・アプリ情報                         |
| 提供項目 | アプリ情報 / 思想・使い方説明 / お問い合わせ導線 |
| 対象外   | テーマ変更 / 通知設定                            |

---

## 6. ビューウィジェット（ゴール詳細画面内）

ゴール詳細画面では、以下の3つのビューを切り替え可能です。

| ビュー名         | ファイル群                     | 目的                     |
| ---------------- | ------------------------------ | ------------------------ |
| リストビュー     | `widgets/views/list_view/`     | MS→Task の階層リスト表示 |
| ピラミッドビュー | `widgets/views/pyramid_view/`  | 階層構造の視覚的表現     |
| カレンダービュー | `widgets/views/calendar_view/` | 期限ベースの可視化       |

---

## 7. 共通ウィジェット

画面間で共有される再利用可能なウィジェット群です。

| ウィジェット      | ファイル                                 | 用途                                    |
| ----------------- | ---------------------------------------- | --------------------------------------- |
| CustomAppBar      | `widgets/common/app_bar_common.dart`     | 統一アプリバー（戻る連打防止付き）      |
| CustomButton      | `widgets/common/custom_button.dart`      | Primary/Secondary/Danger/Text の4タイプ |
| CustomTextField   | `widgets/common/custom_text_field.dart`  | フォーム入力フィールド                  |
| DialogHelper      | `widgets/common/dialog_helper.dart`      | 確認/エラー/削除確認ダイアログ          |
| EmptyState        | `widgets/common/empty_state.dart`        | 空状態表示                              |
| ProgressIndicator | `widgets/common/progress_indicator.dart` | 進捗バー（0〜100%）                     |
| StatusBadge       | `widgets/common/status_badge.dart`       | Todo/Doing/Done バッジ                  |

---

## 8. ルーティング実装

### 8.1 ルート定義

ルーティングは `go_router` で宣言的に定義されています。

```
/                           → SplashPage
/onboarding                 → OnboardingPage
/goal_create                → GoalCreatePage

StatefulShellRoute (BottomNavigation)
├─ Branch 1: /home
│   └─ /home/goal/:goalId
│       ├─ /edit
│       ├─ /milestone_create
│       └─ /milestone/:milestoneId
│           ├─ /edit
│           ├─ /task_create
│           └─ /task/:taskId
│               └─ /edit
├─ Branch 2: /today_tasks
│   └─ /task/:taskId
│       └─ /edit
└─ Branch 3: /settings
```

### 8.2 ルートパス定数

すべてのルートパスは `AppRoutePaths` クラスに定数として定義されています。
ハードコードされたパス文字列の使用は禁止です。

### 8.3 ナビゲーションヘルパー

`AppRouter` クラスが各画面への遷移メソッドを提供しています。
画面コードから直接 `context.go()` / `context.push()` を呼ぶのではなく、
`AppRouter` 経由で遷移することを推奨します。

---

## 9. UX設計方針

### 9.1 基本原則

- **体験が学習である**：説明よりも操作で理解させる
- **最短距離でゴール作成へ導く**
- **自由度を与えないことで迷わせない**

### 9.2 UI の一貫性

- すべての画面は同じ4ファイル構成（Page / State / ViewModel / Widgets）
- 共通ウィジェットを積極的に利用し、画面間のUI差異を最小化
- テーマ（`AppTheme`）で色・タイポグラフィ・スペーシングを統一
