# Post Bugfix Architecture Audit

目的：
不具合修正フェーズ後に崩れやすい

- Clean Architecture
- 責務分離
- 命名統一
- テスト保証力

を再監査し、
長期的に維持可能な状態へ戻す。

---

# 🎯 監査結論（先に）

機能的には改善している。
しかし、

「素早く直した結果」
の歪みが少し入り始めている。

これは正常。

今から整えるのがこの工程。

---

# 現在の総合評価

アーキテクチャ健全性：
88〜92 / 100

以前のピークより少し下がったが、
回復可能な範囲。

---

---

# 🔥 最重要問題群

---

## ❗ Rule1: Presentation が賢くなり始めている

### 症状

- if / switch が増えている
- 条件によって処理を変えている
- Domain の判断を肩代わりしている

### なぜ危険？

UI修正が Domain 破壊に直結する。

### 修正方針

判断は UseCase へ戻す。
UI は依頼者に徹する。

---

---

## ❗ Rule2: 一時対応ロジックが残留

### 症状

- temporary
- workaround
- TODO later

### なぜ危険？

必ず忘れられ腐る。

### 修正方針

UseCase または Domain へ正規化。
不要なら削除。

---

---

## ❗ Rule3: ナビゲーション責務が揺れている

### 症状

画面ごとに戻り先ロジックが違う。

### 危険

画面追加で必ず壊れる。

### 修正

navigation policy を統一。
引数 or router に責務集中。

---

---

## ❗ Rule4: バリデーションの分散

### 症状

UI / UseCase / Entity
複数でチェックしている。

### 危険

二重管理 → 不一致。

### 修正

最終責任は Domain。
UIは補助。

---

---

## ❗ Rule5: 成功前提コードが増えている

### 症状

失敗系を想定しない。

### 危険

境界条件で事故る。

### 修正

必ず失敗経路を持たせる。

---

---

# ⚠ 中規模問題

---

## 命名が短縮され始めている

修正速度優先の影響。

→ 意味が分かる名前へ戻す。

---

## private メソッドの粒度が乱れ始めている

一部肥大。

→ 再分解。

---

## 同種UseCaseで流れが微妙に違う

統一感が少し崩れた。

→ validate → load → domain → save → return  
へ再整列。

---

---

# 🧪 テストの監査

---

## 良い

- 失敗系は維持されている
- 思想防御は残っている

---

## 懸念

新しい分岐に対するテストがまだ薄い。

### 対処

bugfix 起点で
再度テスト追加。

---

---

# 🧹 AI が行うべき修復タスク

優先順：

1. Presentation の判断削減
2. temporary 削除
3. バリデーション責務の整理
4. UseCase 構造統一
5. 命名の復元
6. 新規経路のテスト追加

---

---

# ✨ 修正後の理想状態

- バグは直っている
- しかし設計は以前よりむしろ強い

これが目標。

---

---

# 完了判定

レビュー時に：

「慌てて直した感じがしない」

と言われたら成功。
