# quality_recovery_protocol.md

品質回復プロトコル

目的：
バグ修正フェーズで一時的に崩れた

- Clean Architecture
- 責務分離
- 命名統一
- テスト保証力

を安全に、そして最短距離で回復させる。

感覚ではなく、
誰がやっても同じ結果になる「手順」にする。

---

# 🎯 成功の定義

- Presentation が判断していない
- UseCase の形が揃っている
- Domain が唯一の真実になっている
- 臨時コードが消えている
- テストが新しい経路を捕まえている

---

# 🚫 禁止事項

- 機能追加
- 仕様変更
- リファクタのついで改善
- 抽象化欲求

今やるのは秩序の回復だけ。

---

---

# 🧭 回復の順番（超重要）

順番を守らないと悪化する。

1. Presentation
2. Application / UseCase
3. Validation
4. Naming / Structure
5. Test reinforcement

---

---

# ① Presentation 正常化

## 目標

UI は

表示  
入力  
依頼

だけを行う。

---

## 削除対象

- 条件分岐で業務判断している if
- ステータス決定
- 所属確認
- 成否判定ロジック

---

## 完了形

「UseCase に聞く」だけになっている。

---

---

# ② UseCase の再整列

すべてを次のテンプレへ戻す：

validate  
load  
execute domain  
save  
return

順番が違えば並び替える。

---

---

# ③ バリデーションの主権回収

UI にあるチェックは補助。
最終決定は Domain。

重複があれば Domain に寄せる。

---

---

# ④ 命名の回復

略称禁止。
意味が完全に読めること。

---

---

# ⑤ テストの補強

バグ修正で増えた分岐に
失敗テストを追加。

---

---

# ✨ 終了判定

レビュー時に

「慌てて直した感じが消えている」

これが出れば成功。

---

---

# 🔪 最短回復のための外科手術順

多くの現場で効果があった、
影響範囲が小さくリターンが大きい順。

---

## Step1: Task 系 Presentation

理由：
最も操作が多く、
ここが賢いと全体が濁る。

- today task list
- task detail
- task create

ここから UI の判断を抜く。

---

## Step2: Milestone 系 Presentation

task が綺麗になると
依存しているここも単純化できる。

---

## Step3: Goal 詳細

ピラミッドや進捗表示など、
見た目のためのロジックが入りやすい。
UseCase へ戻す。

---

## Step4: Task 関連 UseCase

UI を削った結果、
足りなくなった責務を正規位置へ戻す。

---

## Step5: 他 UseCase

構造テンプレを完全一致へ。

---

## Step6: 命名 & private 分解

ここでようやく美しさを戻す。

---

## Step7: テスト追加

新しい経路が必ず生まれるため
最後に守る。

---

---

# 🧠 なぜこの順か？

外側 → 内側へ戻す。

これが一番安全。
