# ai_test_generation_prompt.md

不足テストを AI に生成させるための実行プロンプト

目的：
test_gap_report.md で不足していると判定された領域を
安全・正確・思想準拠で自動生成させる。

AI に自由に書かせると
仕様改変や過剰な抽象化が起きるため、
行動を厳密に制限する。

---

# 🎯 ゴール

- 既存設計を守る
- Domain 思想を強化する
- 破壊的変更を検出できるテストを増やす

---

# 🧠 AI に渡す前提知識

このプロダクトは：

- Goal
- Milestone
- Task

の階層構造を持つ。

進捗は自動。
手動変更は禁止。

構造の逸脱は全てエラーである。

---

# 🧪 生成対象カテゴリ

優先順：

1. 不正操作
2. 状態遷移違反
3. 境界値
4. 連鎖更新

---

# 🚨 絶対制約（最重要）

AI は以下を守れ：

- production コードは変更禁止
- public API 変更禁止
- 既存テスト変更禁止
- 振る舞いの定義変更禁止
- repository 実装を賢くしない

やるのは **テスト追加のみ**。

---

# ✍ 出力フォーマット

各テストは必ず：

- 何を守るか
- 何が不正か
- どう失敗すべきか

が読み取れる名前にする。

---

# 命名テンプレ

```
should_fail_when_xxx
should_throw_when_xxx
should_reject_xxx
```

成功系は最後。

---

# 🧨 強制的に増やすべきテスト例

AI は最低限以下を作る：

- 存在しない親
- 他 Goal への付け替え
- 状態スキップ
- 0件
- 全件完了
- cascade 削除
- ID 不一致

---

# 🧪 assertion ルール

曖昧禁止。

例：
❌ isTrue  
⭕ specific exception / specific state

---

# 💬 コメント規則

why のみ許可。
what は名前で示す。

---

# 🧠 完了条件

- 失敗系が増えている
- 境界値が増えている
- 将来の改変が怖くなる

これを満たせば成功。

---

# ✨ 良いテスト生成の兆候

レビュー時に

「うわ、これ壊したら怒られる」

と言われる。
